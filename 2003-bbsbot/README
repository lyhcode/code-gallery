
|===============================|
|                               |
|   PHP-Telnet RoBot 使用手冊   |
|                               |
|===============================|

作者： LyhZz@24PHPDevStudio ( http://24php.twbbs.org/ )

0. 寫在前面

提供下載的程式碼均以GPL v2發行，歡迎複製、修改，並分享您的心得。
您可以至 http://24php.twbbs.org/ 取得最新的訊息或參與討論。

:)請不要利用本程式惡意影響他人，以免無謂徒增大家的困擾！


1. 執行環境需求

最低需求：
  - 可執行PHP程式的作業系統
  - PHP 4 +
  
建議需求：
  - 建議使用 Linux
  - 開發環境 Mandrake 9.1
  - 建議使用 PHP 4.3.0 以上
  - 可顯示中文的環境

由於程式碼完全使用PHP撰寫，應該可以支援不少平台，
但沒有足夠的機器和作業系統可以實際測試，


2. 使用須知

請先編輯 config.php 參考註解的說明修改

命令列執行方式：
./telnet [選項] [主機位址] [埠號]

-d      保留預設(config.php)
-u      帳號名稱
-p      設定密碼
-m      模組名稱

為使用方便，config.php不必設定帳號、密碼及模組
透過命令列的選項來操作可以有較多彈性空間
例如配合 Shell Script 與 Crontab 執行特定的任務

以卡布奇諾(吳鳳技術學院)的BBS站為例，
假設申請的帳號是 mybot 密碼 123
並啟用自動玩金撲克梭哈的模組
範例如下：
./telnet -u mybot -p 123 -m mod_gp bbs.wfc.edu.tw 23

如果不希望密碼直接加在參數(安全性考量)
那麼可以使用：
./telnet -u mybot -p /fgets -m mod_gp bbs.wfc.edu.tw 23

其中密碼設為/fgets是特殊功能選項，
執行時會要求輸入密碼，並且不會顯示在螢幕上


3. 進階使用

這個程式的目的就是要能夠自動操作BBS完成任務
例如用來掛站、回覆訊息、玩遊戲等，

首先要增加新的功能與模組必須先知道PHP程式的寫法，

如果要加入新的模組，必須修改 telnet.php ，
並參考現有的模組設計建立一個新的模組，
同時在config.php及libargv.php加入對應的支援，

libsock.php提供telnet_write()、telnet_buffer()
是模組在處理特殊任務需要用到的函式，
$buff_sock儲存最後街收到的緩衝區資料，
模組負責判斷$buff_sock的內容，
並以telnet_write()把對應的按鍵資料送出，

其實整個流程只是在於做出類似expect工具的兩種動作：
expect "帳號"
send "mybot"

例如要達到這兩個動作可以寫成：
if (telnet_expect("帳號"))
{
    telnet_write($conn_sock, "mybot");
}

因為無法預期緩衝區何時才能出現符合的資料，
必須用迴圈及計時裝置，等待比對的資料出現，
而緩衝區的資料必須利用telnet_buffer()更新，
必須確保緩衝區每次更新的資料都有作過比對，
這樣資料量大的時候才不會容易漏失，
所以主程式的迴圈並不會自動更新緩衝區，


4. 為甚麼是PHP ?

像是Expect工具，就可以做到不少事情，
(我自己寫來玩BBS的Expect Script，
 有自動登入、自動重新連線、回覆訊息)
甚至有時候BBS連線程式提供的快速鍵就足夠，

但是當需求變得比較複雜時，
就不可避免要撰寫程式，
由於大部份的時候寫這種程式，
純粹只是為了好玩的目的，
簡單變成主要的考量。
